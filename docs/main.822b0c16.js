(()=>{"use strict";var e,t=[,(e,t,o)=>{var n=o(751),i=o(641);const r={class:"app-container canvas-container"},a={ref:"playcanvas"},s={style:{position:"absolute",top:"0",left:"0",right:"0",display:"flex",gap:"10px",padding:"10px"}};var l=o(922),c=o(437),d=o(24),h=o(92);let p,u,f,g,w=new Map,m=window.innerWidth/window.innerHeight;const b=new l.mrM({color:0,linewidth:.1,depthWrite:!0,depthTest:!0,opacity:1,transparent:!1}),v=new l.mrM({color:0,linewidth:3,depthWrite:!1,depthTest:!1,opacity:1,transparent:!0});function y(e,t,o){const n=new l.TDQ(e.geometry,o);return new l.DXC(n,t)}const k=new l.V9B({color:new l.Q1f(16777215),transparent:!1,opacity:1,depthTest:!0,side:l.hB5,wireframe:!1}),M={data:()=>({highlightedObjectNames:[],originalMaterials:new Map,sceneObjectsByName:new Map,currentEdgeAngle:20,config:null,currentModelId:null}),methods:{takeHighResScreenshot(e=2){const t=p.domElement.width,o=p.domElement.height;p.setSize(t*e,o*e,!1),p.render(u,f);const n=p.domElement.toDataURL("image/png");p.setSize(t,o,!1),p.render(u,f);const i=document.createElement("a");i.href=n,i.download="screenshot.png",i.click()},clearScene(){this.modelGroup.children.slice().forEach(e=>{e!==w.get("base")&&this.modelGroup.remove(e)});const e=w.get("base");e&&(e.visible=!0),this.sceneObjectsByName.clear(),this.originalMaterials.clear()},focusOnModel(e){if(!e)return;const t=(new l.NRn).setFromObject(e),o=new l.iyt;t.getBoundingSphere(o);const n=o.center,i=o.radius;if(0===i)return;f.lookAt(n);const r=Math.max(1.5*i,1);f.top=r/2,f.bottom=-r/2,f.left=r*m/-2,f.right=r*m/2,f.updateProjectionMatrix(),g.target.copy(n),g.update()},async loadConfig(e){try{const t=await fetch(`${e}.json`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);this.config=await t.json(),console.log("Configuration loaded:",this.config),await this.loadBaseModel(),await this.showModel(0)}catch(e){console.error("Error loading configuration:",e)}},async loadBaseModel(){if(this.config&&this.config.base&&this.config.base.src){this.clearScene();try{const e=await this.loadModelFromUrl(this.config.base.src);e&&(u.add(e),e.traverse(e=>{if(e.isMesh){e.material=k;const t=y(e,b,this.currentEdgeAngle);e.add(t),t.position.x+=.01}}),this.focusOnModel(e))}catch(e){console.error("Error loading base model:",e)}}else console.error("Base model source not defined in config")},showBase(){this.modelGroup.children.forEach(e=>{e.visible=!1})},async showModel(e){if(!this.config)return void console.error("Configuration not loaded");const t=Number.isFinite(e)?this.config.elements[e]:this.config.elements.find(t=>t.id===e);let o=!1;if(this.modelGroup.children.forEach(e=>{e.userData.id===t.id?(o=!0,e.visible=!0):e.visible=!1}),!o)try{const e=await this.loadModelFromUrl(t.src);e&&(e.userData.id=t.id,this.modelGroup.add(e),e.traverse(e=>{if(e.isMesh){e.material.transparent=!1,e.material.opacity=1,e.material.depthWrite=!1,e.material.depthTest=!1,e.material.side=l.$EB,e.material.wireframe=!1;const t=y(e,v,this.currentEdgeAngle);e.add(t),t.position.x+=.01}}))}catch(t){return void console.error(`Error loading model "${e}":`,t)}},loadModelFromUrl:async e=>new Promise((t,o)=>{(new h.B).load(e,e=>t(e.scene),void 0,e=>o(e))}),applyTransform(e,t){t&&t.position&&e.position.set(t.position.x,t.position.y,t.position.z),t&&t.rotation&&e.rotation.set(t.rotation.x,t.rotation.y,t.rotation.z),t&&t.scale&&e.scale.set(t.scale.x,t.scale.y,t.scale.z)},updateHighlightedObjects(e,t=65280){updateHighlightedObjects.call(this,names,t)}},async mounted(){document.documentElement.setAttribute("data-theme","dark");const e=this.$refs.playcanvas;!function(e){const t=window.devicePixelRatio||1;e.forEach(e=>{e.width=e.clientWidth*t,e.height=e.clientHeight*t})}([e]),u=new l.Z58,u.background=new l.Q1f(16777215),p=new c.JeP({antialias:!0,canvas:e,alpha:!0}),p.setSize(window.innerWidth,window.innerHeight),p.setPixelRatio(window.devicePixelRatio),p.shadowMap.enabled=!1,f=new l.qUd(10*m/-2,10*m/2,5,-5,.1,2e3),f.position.set(100,100,100),f.lookAt(0,1,0),g=new d.N(f,e),g.enableDamping=!1,g.dampingFactor=.05;const t=new l.$p8(16777215,1);u.add(t);const o=new l.ZyN(16777215,1);u.add(o),this.modelGroup=new l.YJl,u.add(this.modelGroup),await this.loadConfig("model1"),function e(){requestAnimationFrame(e),g.update(),p.render(u,f)}(),console.log("---READY---")},components:{}},E=(0,o(262).A)(M,[["render",function(e,t,o,n,l,c){return(0,i.uX)(),(0,i.CE)("div",r,[(0,i.Lk)("canvas",a,null,512),(0,i.Lk)("div",s,[(0,i.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>c.showBase&&c.showBase(...e))},"Архитектура"),(0,i.Lk)("button",{onClick:t[1]||(t[1]=e=>c.showModel("vent"))},"Вентиляция"),(0,i.Lk)("button",{onClick:t[2]||(t[2]=e=>c.showModel("canal"))},"Канализация")]),(0,i.Lk)("button",{style:{position:"absolute",top:"0",right:"0"},onClick:t[3]||(t[3]=(...e)=>c.takeHighResScreenshot&&c.takeHighResScreenshot(...e))},"S")])}]]);console.log=()=>{},(window.vue=(0,n.Ef)(E)).mount("#app")}],o={};function n(e){var i=o[e];if(void 0!==i)return i.exports;var r=o[e]={exports:{}};return t[e](r,r.exports,n),r.exports}n.m=t,e=[],n.O=(t,o,i,r)=>{if(!o){var a=1/0;for(d=0;d<e.length;d++){for(var[o,i,r]=e[d],s=!0,l=0;l<o.length;l++)(!1&r||a>=r)&&Object.keys(n.O).every(e=>n.O[e](o[l]))?o.splice(l--,1):(s=!1,r<a&&(a=r));if(s){e.splice(d--,1);var c=i();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[o,i,r]},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={792:0};n.O.j=t=>0===e[t];var t=(t,o)=>{var i,r,[a,s,l]=o,c=0;if(a.some(t=>0!==e[t])){for(i in s)n.o(s,i)&&(n.m[i]=s[i]);if(l)var d=l(n)}for(t&&t(o);c<a.length;c++)r=a[c],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return n.O(d)},o=self.webpackChunk_reneos_slider_editor=self.webpackChunk_reneos_slider_editor||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var i=n.O(void 0,[184,753,776],()=>n(1));i=n.O(i)})();